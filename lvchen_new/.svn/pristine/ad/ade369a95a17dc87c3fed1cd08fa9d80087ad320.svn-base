{"version":3,"sources":["../../src/pages/main/salesAndgift/scangift/scangift.module.ts","../../src/pages/main/salesAndgift/scangift/scangift.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAyC;AACO;AACN;AACA;AAU1C;IAAA;IAAiC,CAAC;IAArB,kBAAkB;QAT9B,wEAAS,EAAE;QACX,uEAAQ,CAAC;YACR,YAAY,EAAE;gBACZ,+DAAY;aACb;YACD,OAAO,EAAE;gBACP,sEAAe,CAAC,QAAQ,CAAC,+DAAY,CAAC;aACvC;SACF,CAAC;OACW,kBAAkB,CAAG;IAAD,yBAAC;CAAA;AAAH;;;;;;;;;;;;;;;;;;;;;;;ACboB;AACyD;AACvC;AAC4B;AAEjG;;;;;GAKG;AAOH;IAYE,sBACS,OAAsB,EACtB,SAAoB,EACnB,SAAoB,EACrB,QAAwB,EACxB,SAA0B,EAC1B,UAAsB,EACtB,QAAkB;QANlB,YAAO,GAAP,OAAO,CAAe;QACtB,cAAS,GAAT,SAAS,CAAW;QACnB,cAAS,GAAT,SAAS,CAAW;QACrB,aAAQ,GAAR,QAAQ,CAAgB;QACxB,cAAS,GAAT,SAAS,CAAiB;QAC1B,eAAU,GAAV,UAAU,CAAY;QACtB,aAAQ,GAAR,QAAQ,CAAU;QAjBjB,UAAK,GAAY,KAAK,CAAC;QACvB,gBAAW,GAAY,KAAK,CAAC;QAChC,mBAAc,GAAC,KAAK,CAAC;QAE5B,QAAG,GAAG,CAAC,CAAC;QACR,YAAO,GAAG,IAAI,CAAC;QACf,SAAS;QACF,eAAU,GAAC,EAAE,CAAC;QACX,YAAO,GAAG,KAAK,CAAC;IAW1B,CAAC;IACD,uCAAgB,GAAhB;QAAA,iBAoBC;QAnBC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,KAAK,EAAC,aAAG;YAC/B,KAAI,CAAC,UAAU,GAAC,GAAG,CAAC,YAAY,CAAC,IAAE,EAAE,CAAC;YAEtC,KAAI,CAAC,GAAG,GAAC,KAAI,CAAC,UAAU,CAAC,MAAM,IAAE,CAAC,CAAC;QACrC,CAAC,CAAC;QACD,QAAQ;QACR,IAAI,CAAC,OAAO,GAAC,KAAK,CAAC;QACnB,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE;aACvB,IAAI,CAAC,UAAC,MAAuB;YAE5B,EAAE,CAAC,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC;gBAEtB,KAAI,CAAC,IAAI,EAAE,CAAC;gBAEZ,KAAI,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC;YAExB,CAAC;QACL,CAAC,CAAC;aACD,KAAK,CAAC,UAAC,CAAM,IAAK,cAAO,CAAC,GAAG,CAAC,UAAU,EAAE,CAAC,CAAC,EAA1B,CAA0B,CAAC,CAAC;IAChD,CAAC;IAED,+BAAQ,GAAR;QAAA,iBAcC;QAZC,UAAU,CAAC;YACT,KAAI,CAAC,cAAc,GAAC,IAAI,CAAC;QAC3B,CAAC,EAAC,GAAG,CAAC,CAAC;QAEP,MAAM;QACN,IAAI,CAAC,MAAM,CAAC,eAAe,GAAG,UAAC,CAAS;YACtC,KAAI,CAAC,MAAM,EAAE,CAAC;QAChB,CAAC;QACD,IAAI,CAAC,QAAQ,CAAC,wBAAwB,CAAC;YACrC,KAAI,CAAC,MAAM,EAAE,CAAC;QAChB,CAAC,CAAC,CAAC;IAEL,CAAC;IAED,6BAAM,GAAN;QAAA,iBAoCC;QAnCC,IAAI,CAAC,OAAO,GAAC,IAAI,CAAC;QAClB,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,IAAE,CAAC,CAAC,CAAC,CAAC;YACd,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC;YACxB,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,CAAC;QAC7B,CAAC;QAAA,IAAI,EAAC;YACF,IAAI,SAAO,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;gBAClC,KAAK,EAAE,IAAI;gBACX,OAAO,EAAE,gBAAgB;gBACzB,OAAO,EAAE;oBACP;wBACE,IAAI,EAAE,IAAI;wBACV,OAAO,EAAE;4BACP,IAAI,CAAC;gCACH,KAAI,CAAC,UAAU,CAAC,UAAU,CAAC,IAAI,CAAC;gCAChC,KAAI,CAAC,OAAO,GAAG,IAAI,CAAC;gCACpB,KAAI,CAAC,SAAS,CAAC,OAAO,EAAE,CAAC;4BAC3B,CAAC;4BAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;4BAEb,CAAC;oCAAS,CAAC;gCACT,KAAI,CAAC,OAAO,CAAC,SAAS,EAAE,CAAC;4BAC3B,CAAC;wBAEH,CAAC;qBACF;oBACD;wBACE,IAAI,EAAE,IAAI;wBACV,OAAO,EAAE;4BACP,KAAI,CAAC,OAAO,GAAC,KAAK,CAAC;4BACrB,KAAI,CAAC,IAAI,EAAE,CAAC;wBACZ,CAAC;qBACF;iBACF;aACF,CAAC,CAAC;YACH,SAAO,CAAC,OAAO,EAAE,CAAC;QACtB,CAAC;IACH,CAAC;IACD,OAAO;IACP,2BAAI,GAAJ;QAAA,iBA2BC;QA1BA,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC,SAAS,CAAC,UAAC,IAAY;YAC1C,EAAE,CAAC,CAAC,KAAI,CAAC,OAAO,CAAC,CAAC,CAAC;gBACjB,KAAI,CAAC,WAAW,EAAE,CAAC;gBACnB,MAAM,CAAC;YACT,CAAC;YACD,KAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,mBAAmB,EAC1C,EAAC,IAAI,EAAC,IAAI,EAAC,EAAC,cAAI;gBAChB,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;oBACpB,KAAI,CAAC,UAAU,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;gBAClC,CAAC;gBAAA,IAAI,EAAC;oBACJ,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,CAAC,CAAC,CAAC;wBAC3B,KAAI,CAAC,UAAU,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;oBAC/B,CAAC;oBAAA,IAAI,EAAC;wBACL,KAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;oBACpC,CAAC;gBAEH,CAAC;gBACD,IAAI,OAAO,GAAG,UAAU,CAAC;oBACvB,EAAE,CAAC,CAAC,CAAC,KAAI,CAAC,OAAO,CAAC,CAAC,CAAC;wBAClB,KAAI,CAAC,IAAI,EAAE,CAAC;oBACd,CAAC;oBACD,YAAY,CAAC,OAAO,CAAC,CAAC;gBACxB,CAAC,EAAE,GAAG,CAAC,CAAC;YAEV,CAAC,EAAC,IAAI,CAAC,CAAC;QACV,CAAC,CAAC,CAAC;IACL,CAAC;IAED,kCAAW,GAAX;QAAA,iBAKC;QAJC,IAAI,IAAI,GAAG,UAAU,CAAC;YACpB,KAAI,CAAC,IAAI,EAAE,CAAC;YACZ,YAAY,CAAC,IAAI,CAAC;QACpB,CAAC,EAAE,GAAG,CAAC;IACT,CAAC;IAED,6BAAM,GAAN;QACE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,gBAAgB,EAAC;YACjC,SAAS,EAAE,eAAe;SAC3B,CAAC,CAAC;IACL,CAAC;IAED,IAAI;IACJ,6BAAM,GAAN;QACE,IAAI,CAAC,OAAO,GAAC,IAAI,CAAC;QAClB,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,CAAC;QACzB,IAAI,MAAM,GAAC;YACT,UAAU,EAAC,IAAI,CAAC,UAAU;SAC3B;QACD,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,KAAK,EAAC,MAAM,CAAC;QACrC,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC;IACrB,CAAC;IAED,sCAAe,GAAf,UAAgB,IAAI;QAApB,iBAqCC;QApCC,IAAI,CAAC,OAAO,GAAC,IAAI,CAAC;QAClB,IAAI,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC;QAEpC,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QAEzB,KAAK,CAAC,QAAQ,CAAC;YACX,IAAI,EAAE,OAAO;YACb,KAAK,EAAE,KAAK;YACZ,KAAK,EAAE,GAAG;YACV,OAAO,EAAE,KAAK;SACjB,CAAC,CAAC;QAEH,KAAK,CAAC,QAAQ,CAAC;YACX,IAAI,EAAE,OAAO;YACb,KAAK,EAAE,KAAK;YACZ,KAAK,EAAE,GAAG;YACV,OAAO,EAAE,KAAK;SACjB,CAAC,CAAC;QAEH,KAAK,CAAC,QAAQ,CAAC;YACX,IAAI,EAAE,OAAO;YACb,KAAK,EAAE,IAAI;YACX,KAAK,EAAE,GAAG;YACV,OAAO,EAAE,IAAI;SAChB,CAAC,CAAC;QAEH,KAAK,CAAC,SAAS,CAAC;YACd,IAAI,EAAE,IAAI;YACV,OAAO,EAAE,gBAAM;gBACb,KAAI,CAAC,OAAO,GAAC,KAAK,CAAC;gBACnB,KAAI,CAAC,UAAU,CAAC,IAAI,CAAC,EAAC,IAAI,EAAC,IAAI,CAAC,OAAO,EAAC,MAAM,EAAC,IAAI,CAAC,SAAS,EAAC,KAAK,EAAC,GAAG,EAAC,QAAQ,EAAC,MAAM,EAAC,CAAC,CAAC;gBAC1F,KAAI,CAAC,GAAG,GAAG,KAAI,CAAC,UAAU,CAAC,MAAM,CAAC;gBAClC,KAAI,CAAC,IAAI,EAAE,CAAC;YACd,CAAC;SACF,CAAC,CAAC;QACH,KAAK,CAAC,OAAO,EAAE,CAAC;IAClB,CAAC;IA3LiB;QAAjB,yEAAS,CAAC,6DAAM,CAAC;kCAAO,6DAAM;gDAAC;IADrB,YAAY;QAJxB,wEAAS,CAAC;YACT,QAAQ,EAAE,eAAe;WACG;SAC7B,CAAC;6EAc+B;YACX,2EAAS;YACR,qEAAS;YACX,sEAAc;YACb,6GAAe;YACd,iEAAU;YACZ,QAAQ;OAnBhB,YAAY,CA8LxB;IAAD,CAAC;AAAA;SA9LY,YAAY,e","file":"21.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { ScangiftPage } from './scangift';\nimport { IonicPage } from 'ionic-angular';\n@IonicPage()\n@NgModule({\n  declarations: [\n    ScangiftPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(ScangiftPage),\n  ],\n})\nexport class ScangiftPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/main/salesAndgift/scangift/scangift.module.ts","import { Component,ViewChild} from '@angular/core';\nimport { IonicPage,Navbar,Platform, NavController, NavParams, ViewController,AlertController} from 'ionic-angular';\nimport { QRScanner,QRScannerStatus } from '@ionic-native/qr-scanner';\nimport { AppService } from '../../../../providers/service-public-service/service-public-service';\n\n/**\n * Generated class for the  page.\n *\n * See https://ionicframework.com/docs/components/#navigation for more info on\n * Ionic pages and navigation.\n */\n\n@IonicPage()\n@Component({\n  selector: 'page-scangift',\n  templateUrl: 'scangift.html',\n})\nexport class ScangiftPage {\n  @ViewChild(Navbar)navbar:Navbar;\n  protected light: boolean = false;\n  protected frontCamera: boolean = false;\n  public backgroundnone=false;\n  userId;\n  num = 0;\n  isFirst = true;\n  // 储存本地变量\n  public presentMap=[];\n  protected destory = false;\n\n  constructor(\n    public navCtrl: NavController,\n    public navParams: NavParams,\n    private qrScanner: QRScanner,\n    public viewCtrl: ViewController,\n    public alertCtrl: AlertController,\n    public appService: AppService,\n    public platform: Platform\n  ) {\n  }\n  ionViewWillEnter(){\n    this.appService.getItem('pre',val=>{\n      this.presentMap=val['presentMap']||[];\n      \n      this.num=this.presentMap.length||0;\n    })\n     //获取摄像权限\n     this.destory=false;\n     this.qrScanner.prepare()\n     .then((status: QRScannerStatus) => {\n\n       if (status.authorized) {\n\n         this.scan();\n\n         this.qrScanner.show();\n\n       }\n   })\n   .catch((e: any) => console.log('Error is', e));\n  }\n\n  ngOnInit() {\n\n    setTimeout(()=>{\n      this.backgroundnone=true;\n    },800);\n   \n    //返回提示\n    this.navbar.backButtonClick = (e:UIEvent)=>{\n      this.onBack();\n    }\n    this.platform.registerBackButtonAction(() => {\n      this.onBack();\n    });\n   \n  }\n  \n  onBack(){\n    this.destory=true;\n    if (this.num==0) {\n        this.viewCtrl.dismiss();\n        this.qrScanner.destroy();\n    }else{\n        let confirm = this.alertCtrl.create({\n          title: '提示',\n          message: '您的操作未完成，确定要退出？',\n          buttons: [\n            {\n              text: '确定',\n              handler: () => {\n                try {\n                  this.appService.removeItem('cb')\n                  this.destory = true;\n                  this.qrScanner.destroy();\n                } catch (e) {\n  \n                } finally {\n                  this.navCtrl.popToRoot();\n                }\n  \n              }\n            },\n            {\n              text: '取消',\n              handler: () => {\n                this.destory=false;\n              this.scan();\n              }\n            }\n          ]\n        });\n        confirm.present();\n    }\n  }\n  //开启扫一扫\n  scan(){\n   this.qrScanner.scan().subscribe((text: string) => {\n      if (this.destory) {\n        this.restartScan();\n        return;\n      }\n      this.appService.httpPost('findGiftGoods.api',\n        {code:text},data => {\n        if (data.code == -1) {\n          this.appService.toast(data.msg);\n        }else{\n          if (data.data.length == 0) {\n          \tthis.appService.toast('没有结果');\n          }else{\n          \tthis.showSourceRadio(data.data[0]);\n          }\n         \n        }\n        var timeout = setTimeout(() => {\n          if (!this.destory) {\n            this.scan();\n          }\n          clearTimeout(timeout);\n        }, 500);\n       \n      },true);\n    });\n  }\n  \n  restartScan(){\n    let time = setTimeout(() => {\n      this.scan();\n      clearTimeout(time)\n    }, 500)\n  }\n\n  search(){\n    this.navCtrl.push('SelectGiftPage',{\n      animation: 'md-transition'\n    });\n  }\n\n  //提交\n  submit() {\n    this.destory=true;\n    this.qrScanner.destroy();\n    let params={\n      presentMap:this.presentMap,\n    }\n    this.appService.setItem('pre',params)\n    this.navCtrl.pop();\n  }\n\n  showSourceRadio(data) {\n    this.destory=true;\n    let alert = this.alertCtrl.create();\n    \n    alert.setTitle('选择礼品来源');\n\n    alert.addInput({\n        type: 'radio',\n        label: \"借门店\",\n        value: '0',\n        checked: false\n    });\n    \n    alert.addInput({\n        type: 'radio',\n        label: \"欠顾客\",\n        value: '1',\n        checked: false\n    });\n\n    alert.addInput({\n        type: 'radio',\n        label: \"其它\",\n        value: '2',\n        checked: true\n    });\n\n    alert.addButton({\n      text: '确定',\n      handler: result => {\n        this.destory=false;\n        this.presentMap.push({'id':data.goodsId,'name':data.goodsName,'num':'1','source':result});\n        this.num = this.presentMap.length;\n        this.scan();\n      }\n    });\n    alert.present();\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/main/salesAndgift/scangift/scangift.ts"],"sourceRoot":""}